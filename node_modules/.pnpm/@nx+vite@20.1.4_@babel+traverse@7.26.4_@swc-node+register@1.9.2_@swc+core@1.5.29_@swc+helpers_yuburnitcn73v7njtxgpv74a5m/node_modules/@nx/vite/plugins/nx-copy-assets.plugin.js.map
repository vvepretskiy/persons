{"version":3,"sources":["../../../../packages/vite/plugins/nx-copy-assets.plugin.ts"],"sourcesContent":["import { join, relative } from 'node:path';\nimport type { Plugin, ResolvedConfig } from 'vite';\nimport { joinPathFragments, workspaceRoot } from '@nx/devkit';\nimport { AssetGlob } from '@nx/js/src/utils/assets/assets';\nimport { CopyAssetsHandler } from '@nx/js/src/utils/assets/copy-assets-handler';\n\nexport function nxCopyAssetsPlugin(_assets: (string | AssetGlob)[]): Plugin {\n  let config: ResolvedConfig;\n  let handler: CopyAssetsHandler;\n  let dispose: () => void;\n\n  return {\n    name: 'nx-copy-assets-plugin',\n    configResolved(_config) {\n      config = _config;\n    },\n    async buildStart() {\n      const relativeProjectRoot = relative(workspaceRoot, config.root);\n      const assets = _assets.map((a) => {\n        if (typeof a === 'string') {\n          return joinPathFragments(relativeProjectRoot, a);\n        } else {\n          return {\n            ...a,\n            input: joinPathFragments(relativeProjectRoot, a.input),\n          };\n        }\n      });\n      handler = new CopyAssetsHandler({\n        rootDir: workspaceRoot,\n        projectDir: config.root,\n        outputDir: join(config.root, config.build.outDir),\n        assets,\n      });\n      if (this.meta.watchMode) {\n        dispose = await handler.watchAndProcessOnAssetChange();\n      }\n    },\n    async writeBundle() {\n      await handler.processAllAssetsOnce();\n    },\n    async closeWatcher() {\n      dispose == null ? void 0 : dispose();\n    },\n  };\n}\n"],"names":["nxCopyAssetsPlugin","_assets","config","handler","dispose","name","configResolved","_config","buildStart","relativeProjectRoot","relative","workspaceRoot","root","assets","map","a","joinPathFragments","input","CopyAssetsHandler","rootDir","projectDir","outputDir","join","build","outDir","meta","watchMode","watchAndProcessOnAssetChange","writeBundle","processAllAssetsOnce","closeWatcher"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";+BAMgBA;;;eAAAA;;;;0BANe;wBAEkB;mCAEf;AAE3B,SAASA,mBAAmBC,OAA+B;IAChE,IAAIC;IACJ,IAAIC;IACJ,IAAIC;IAEJ,OAAO;QACLC,MAAM;QACNC,gBAAeC,OAAO;YACpBL,SAASK;QACX;QACA,MAAMC;YACJ,MAAMC,sBAAsBC,IAAAA,kBAAQ,EAACC,qBAAa,EAAET,OAAOU,IAAI;YAC/D,MAAMC,SAASZ,QAAQa,GAAG,CAAC,CAACC;gBAC1B,IAAI,OAAOA,MAAM,UAAU;oBACzB,OAAOC,IAAAA,yBAAiB,EAACP,qBAAqBM;gBAChD,OAAO;oBACL,OAAO,eACFA;wBACHE,OAAOD,IAAAA,yBAAiB,EAACP,qBAAqBM,EAAEE,KAAK;;gBAEzD;YACF;YACAd,UAAU,IAAIe,oCAAiB,CAAC;gBAC9BC,SAASR,qBAAa;gBACtBS,YAAYlB,OAAOU,IAAI;gBACvBS,WAAWC,IAAAA,cAAI,EAACpB,OAAOU,IAAI,EAAEV,OAAOqB,KAAK,CAACC,MAAM;gBAChDX;YACF;YACA,IAAI,IAAI,CAACY,IAAI,CAACC,SAAS,EAAE;gBACvBtB,UAAU,MAAMD,QAAQwB,4BAA4B;YACtD;QACF;QACA,MAAMC;YACJ,MAAMzB,QAAQ0B,oBAAoB;QACpC;QACA,MAAMC;YACJ1B,WAAW,OAAO,KAAK,IAAIA;QAC7B;IACF;AACF"}